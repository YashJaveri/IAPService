(()=>{"use strict";var e={318:e=>{e.exports=JSON.parse('{"type":"service_account","project_id":"iapservice","private_key_id":"a359781f9938f704c806b45d05b5cbe880899c0a","private_key":"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQDLrRHcIjVJWAMT\\nCRqZ+ccn+gNv02xT8o+PMVPqBIUefDd7+3Txzz0rQsgcaaFy8qDVm4lZfWS536e8\\nw4B20HiSSacweJrxx4+yPVD7EYXBwtldU9fWrBI+NVJ+BH5U8Dfn3Yd7CElcpjrC\\nWgASvldeeI+rwgLTbmkqoWJOjfYZB670S4aOvpENeEVfv9BFdaae3EsXSrWMwduu\\nZkJa1YnwOH74qYAxs/5oVSTfYkwxZLh0bHdqzM1TR9mZhMIzIqnlX90RBAa7nMc+\\nPOugVsTNbuttN1Z/BsEfApyFaruMGv7SY5a9UH7ayJYPJm6k3//JSzBGkakSoAtL\\nNDMu/dVDAgMBAAECggEAKHatwaoaJAQUOEfqvQReiJam8CR0tQjPdIc8QJW9TJ0o\\n+LywMwoVAO83ik2CAbAqO8W2t8ytoi/Ixzuf3fr0uTtgt8R+I+Kdra940yhcBm6L\\neHsbuk5dIXa+eMKzxnQi5zGfpNW0nW945Pu0YATonqAdCuZ0YUTiJ9IAEdMqPTZq\\nuug76+G4/Zs7oeUfGMI0qLtP18SyzTwA/qTTe+1DbLU6vjr8whlT+UE1/EJeRNdH\\nWEtPPvXeGxgNwMg9tL+fgD7o6WH7Fv+UP6Fq5LG2CEB0YxlUi3quwqDp/J2EDGa+\\np1SB+BB05yDL3B+RQk2eAkjWaBRNhsQiuv74onb6oQKBgQDvYCXL+YxLtt8s9h8M\\nrMkoP1z5O2y9QhwozUgaUuIwXhzxObYYHUxDE+5kAncTjBRHeowluype6WAhnSWM\\nj6H5oTsJ7C66aKus8rNjgv730RUuSnnEz+aFmIrkF2wzlvMdli3KzF/yQ0i+0HNg\\nciSKKLQyaZxUBLOmZk4bGgmCBQKBgQDZ0jigoGkmcVWDHbe1t6K2oJ5f4FbhXfCH\\nLXMN+9L1phJItBA2MgO6plRdWBM0GYagVKmq6D1EyjTvQlRiw2hhnttEE7WsGSlZ\\n277OOjHq1V7qwq1f4kMv3AsYWbZ566m/I8RcP9rSwRIle1k2RaFDc6AuDnQU5U7p\\nMpHee600pwKBgQCM5Wv57q3clwwv28KU5FMWxI0GCitMDtCiV4o8LFMEozCn8A81\\njHEp/l5QMX9DWy1IkWJShyM+cGFsB6JlZNmzJGqqwYETqa57AvQB+8X1ufScpauc\\n475NHmeKMBs5Fn2NCat0de13nJEB95Ihz62gQKsoDS+96HKR3B/XJfE4vQKBgQCv\\nquDMelITFNf4FGFyhhUN4F+Zxx2KR+6Rtk/R+UPbpQGd7MoeSxvCzh2/4iYqoGN4\\nro7fLMkszz79rqrLs/hcsnb3YkXj867rr1Mkkr5rO4V/I14btCinUnkIPGHz1eFi\\nK4BTPZRG4Dq4S9BY+rLh6UBHpJRtvbl0TLpjia7YhQKBgQCBm55LBp0MpqvUgJcl\\nSy7OWDqg6PvGsuTdFV3jIzN78XSBkfI0RyPMygT224JDmnRYabcmIcS/bA4HnswT\\nfsTJG0/3RoDfr/fV7/FxsM+F10kh2YiLhmd0rlj2FNDJwaiJrTbsaymYutmmEJBO\\n7XZjJdiPbcFeasicUoB1wICscQ==\\n-----END PRIVATE KEY-----\\n","client_email":"firebase-adminsdk-q0hwn@iapservice.iam.gserviceaccount.com","client_id":"100681325628266909783","auth_uri":"https://accounts.google.com/o/oauth2/auth","token_uri":"https://oauth2.googleapis.com/token","auth_provider_x509_cert_url":"https://www.googleapis.com/oauth2/v1/certs","client_x509_cert_url":"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-q0hwn%40iapservice.iam.gserviceaccount.com"}')}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{const e=require("firebase-admin"),t=require("express");var r=n.n(t);const o=require("mongoose");var a=n.n(o);const i=require("cors");var u=n.n(i),s=[r().json({limit:"50mb"}),r().urlencoded({extended:!0})];const c=function(){function e(e,t,n){void 0===t&&(t=400),this.responseCode=400,this.message=n,this.resultCode=e,this.responseCode=t,this.name="ApiError"}return e.prototype.toResponseData=function(){return{message:this.message,resultCode:this.resultCode}},e}(),l=require("http");var f=n.n(l);function d(e){var t=this;return function(n,r,o){var a,i,u,s;(a=t,i=void 0,u=void 0,s=function(){return function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}}(this,(function(t){switch(t.label){case 0:return[4,e(n,r,o)];case 1:return t.sent(),[2]}}))},new(u||(u=Promise))((function(e,t){function n(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof u?o:new u((function(e){e(o)}))).then(n,r)}o((s=s.apply(a,i||[])).next())}))).catch((function(e){if("ApiError"===e.name)o(e);else{var t=new c("unknown-error",500,e.message);o(t)}}))}}var p=new o.Schema({firebaseId:{type:String,require:[!0,"Firebase id is required"]},name:{type:String,default:""},email:{type:String,require:[!0,"Email is required"]},phoneNumber:{type:String,unique:!0,default:""},apikey:{type:String,default:""},billingEnabled:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},googleConfig:{type:{},default:null},appleConfig:{type:{secret:{type:String,default:""}},default:{secret:""}},amazonConfig:{type:{userId:{type:String,default:""},secret:{type:String,default:""}},default:{userId:"",secret:""}}}),h=(0,o.model)("user",p),v=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))},b=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},g=function(){function e(e,t,n){this.message="",this.resultCode="00",this.data={},this.data=e,this.message=n,this.resultCode=t}return e.prototype.toJSON=function(){return{data:this.data,message:this.message,resultCode:this.resultCode}},e}(),w=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,u)}s((r=r.apply(e,t||[])).next())}))},y=function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},m=(0,t.Router)();m.post("/",d((function(e,t){return w(void 0,void 0,void 0,(function(){var n,r;return y(this,(function(o){switch(o.label){case 0:Object.assign(e.user,e.body),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.user.save()];case 2:return void 0!==(n=o.sent())&&t.send(new g(n).toJSON()),[3,4];case 3:throw r=o.sent(),console.log(r),new c("unknown-error",400,r.message);case 4:return[2]}}))}))}))),m.get("/",d((function(e,t){return w(void 0,void 0,void 0,(function(){return y(this,(function(n){return t.send(new g(e.user).toJSON()),[2]}))}))})));var k=(0,t.Router)(),B=(0,t.Router)();B.use(function(){var t=this;return d((function(n,r,o){return v(t,void 0,void 0,(function(){var t,r,a=this;return b(this,(function(i){switch(i.label){case 0:return(t=null===(r=n.headers.authorization)||void 0===r?void 0:r.replace("Bearer ","").trim())?[4,e.auth().verifyIdToken(t).then((function(e){return v(a,void 0,void 0,(function(){var t,r,a;return b(this,(function(i){switch(i.label){case 0:return t=e.uid,[4,h.findOne({firebaseId:t})];case 1:return i.sent()?[3,2]:(console.log("User not found hence creating"),r={firebaseId:t,email:e.email},h.create(r,(function(e,t){if(e)throw console.log("Error creating: "+e.message),e;n.user=t,o()})),[3,4]);case 2:return a=n,[4,h.findOne({firebaseId:t})];case 3:a.user=i.sent(),o(),i.label=4;case 4:return[2]}}))}))})).catch((function(e){throw new c("user-not-found",404,"User not found!")}))]:[3,2];case 1:return i.sent(),[3,3];case 2:throw new c("invalid-jwt",401,"Invalid jwt");case 3:return[2]}}))}))}))}()),B.use("/auth/profile",m),B.use("/verify",k);var S=r()(),x=n(318);e.initializeApp({credential:e.credential.cert(x)}),S.use(u()()),S.use(s),S.use(B),S.use((function(e,t,n,r){e.constructor===c&&"ApiError"===e.name?n.status(e.responseCode).send(e.toResponseData()):(n.sendStatus(500),console.log(e))}));var q=f().createServer(S);a().connect("mongodb://127.0.0.1:27017/IAPService",{useNewUrlParser:!0,useUnifiedTopology:!0,useCreateIndex:!0}).then((function(){q.listen(process.env.PORT||8080,(function(){console.log("Server Running...")}))}))})()})();